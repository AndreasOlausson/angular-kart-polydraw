import * as L from "leaflet";
import * as turf from "@turf/turf";
export class PolygonUtil {
    static getCenter(polygon) {
        const pi = Math.PI;
        let x = 0;
        let y = 0;
        let z = 0;
        polygon.forEach(v => {
            let lat1 = v.lat;
            let lon1 = v.lng;
            lat1 = lat1 * pi / 180;
            lon1 = lon1 * pi / 180;
            x += Math.cos(lat1) * Math.cos(lon1);
            y += Math.cos(lat1) * Math.sin(lon1);
            z += Math.sin(lat1);
        });
        let lng = Math.atan2(y, x);
        const hyp = Math.sqrt(x * x + y * y);
        let lat = Math.atan2(z, hyp);
        lat = lat * 180 / pi;
        lng = lng * 180 / pi;
        const center = { lat: lat, lng: lng };
        return center;
    }
    static getSouthWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    }
    static getNorthEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthEast();
    }
    static getNorthWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    }
    static getSouthEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getSouthEast();
    }
    static getNorth(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorth();
    }
    static getSouth(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getSouth();
    }
    static getWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getWest();
    }
    static getEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getEast();
    }
    static getSqmArea(polygon) {
        const poly = new L.Polygon(polygon);
        const geoJsonPoly = poly.toGeoJSON();
        const area = turf.area((geoJsonPoly));
        return area;
    }
    static getPerimeter(polygon) {
        const poly = new L.Polygon(polygon);
        const geoJsonPoly = poly.toGeoJSON();
        const perimeter = turf.length((geoJsonPoly), { units: "meters" });
        return perimeter;
    }
    static getPolygonChecksum(polygon) {
        const uniqueLatLngs = polygon.filter((v, i, a) => {
            return a.indexOf(a.find(x => x.lat === v.lat && x.lng === v.lng)) === i;
        });
        return uniqueLatLngs.reduce((a, b) => +a + +b.lat, 0) * uniqueLatLngs.reduce((a, b) => +a + +b.lng, 0);
    }
    static getMidPoint(point1, point2) {
        const p1 = turf.point([point1.lng, point1.lat]);
        const p2 = turf.point([point2.lng, point2.lat]);
        const midpoint = turf.midpoint(p1, p2);
        const returnPoint = {
            lat: midpoint.geometry.coordinates[1],
            lng: midpoint.geometry.coordinates[0]
        };
        return returnPoint;
    }
    static getBounds(polygon) {
        const tmpLatLng = [];
        polygon.forEach(ll => {
            if (isNaN(ll.lat) || isNaN(ll.lng)) {
            }
            tmpLatLng.push(ll);
        });
        const polyLine = new L.Polyline(tmpLatLng);
        const bounds = polyLine.getBounds();
        return bounds;
    }
}
//export class FreedrawSubtract extends L.FreeDraw {
//    constructor() {
//        //this will become L.FreeDraw
//        super(null);
//        //call methods in freedraw by this
//        const foo = this.size();
//        this.consoleLogNumberOfPolygons(foo);
//    }
//    consoleLogNumberOfPolygons(size: number): void {
//        console.log("Number of polygons: ", size);
//    }
//}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWdvbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbXktbGliLyIsInNvdXJjZXMiOlsibGliL3BvbHlnb24udXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFNBQVMsQ0FBQztBQUM3QixPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQTtBQUdsQyxNQUFNLE9BQU8sV0FBVztJQUNwQixNQUFNLENBQUMsU0FBUyxDQUFDLE9BQWtCO1FBQy9CLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRVYsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNoQixJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ2pCLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDakIsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUN2QixDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FB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QztRQUVoRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUV2QyxNQUFNLFdBQVcsR0FBWTtZQUN6QixHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLEdBQUcsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7U0FDeEMsQ0FBQztRQUVGLE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQWtCO1FBQy9CLE1BQU0sU0FBUyxHQUFlLEVBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ2pCLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2FBQ25DO1lBQ0QsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFjLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN2RCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFcEMsT0FBTyxNQUFNLENBQUM7SUFFbEIsQ0FBQztDQUNKO0FBRUQsb0RBQW9EO0FBR3BELHFCQUFxQjtBQUVyQix1Q0FBdUM7QUFDdkMsc0JBQXNCO0FBQ3RCLDRDQUE0QztBQUM1QyxrQ0FBa0M7QUFFbEMsK0NBQStDO0FBRS9DLE9BQU87QUFFUCxzREFBc0Q7QUFDdEQsb0RBQW9EO0FBQ3BELE9BQU87QUFFUCxHQUFHIiwic291cmNlc0NvbnRlbnQiOlsiXG5pbXBvcnQgKiBhcyBMIGZyb20gXCJsZWFmbGV0XCI7XG5pbXBvcnQgKiBhcyB0dXJmIGZyb20gXCJAdHVyZi90dXJmXCJcbmltcG9ydCB7IElMYXRMbmcgfSBmcm9tIFwiLi9wb2x5Z29uLWhlbHBlcnNcIjtcblxuZXhwb3J0IGNsYXNzIFBvbHlnb25VdGlsIHtcbiAgICBzdGF0aWMgZ2V0Q2VudGVyKHBvbHlnb246IElMYXRMbmdbXSkge1xuICAgICAgICBjb25zdCBwaSA9IE1hdGguUEk7XG4gICAgICAgIGxldCB4ID0gMDtcbiAgICAgICAgbGV0IHkgPSAwO1xuICAgICAgICBsZXQgeiA9IDA7XG5cbiAgICAgICAgcG9seWdvbi5mb3JFYWNoKHYgPT4ge1xuICAgICAgICAgICAgbGV0IGxhdDEgPSB2LmxhdDtcbiAgICAgICAgICAgIGxldCBsb24xID0gdi5sbmc7XG4gICAgICAgICAgICBsYXQxID0gbGF0MSAqIHBpIC8gMTgwO1xuICAgICAgICAgICAgbG9uMSA9IGxvbjEgKiBwaSAvIDE4MDtcbiAgICAgICAgICAgIHggKz0gTWF0aC5jb3MobGF0MSkgKiBNYXRoLmNvcyhsb24xKTtcbiAgICAgICAgICAgIHkgKz0gTWF0aC5jb3MobGF0MSkgKiBNYXRoLnNpbihsb24xKTtcbiAgICAgICAgICAgIHogKz0gTWF0aC5zaW4obGF0MSk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGxldCBsbmcgPSBNYXRoLmF0YW4yKHksIHgpO1xuICAgICAgICBjb25zdCBoeXAgPSBNYXRoLnNxcnQoeCAqIHggKyB5ICogeSk7XG4gICAgICAgIGxldCBsYXQgPSBNYXRoLmF0YW4yKHosIGh5cCk7XG4gICAgICAgIGxhdCA9IGxhdCAqIDE4MCAvIHBpO1xuICAgICAgICBsbmcgPSBsbmcgKiAxODAgLyBwaTtcbiAgICAgICAgY29uc3QgY2VudGVyOiBJTGF0TG5nID0geyBsYXQ6IGxhdCwgbG5nOiBsbmcgfTtcblxuICAgICAgICByZXR1cm4gY2VudGVyO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U291dGhXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcbiAgICB9XG4gICAgc3RhdGljIGdldE5vcnRoRWFzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBJTGF0TG5nIHtcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXROb3J0aFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xuICAgICAgICByZXR1cm4gYm91bmRzLmdldE5vcnRoV2VzdCgpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U291dGhFYXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRTb3V0aEVhc3QoKTtcbiAgICB9XG4gICAgc3RhdGljIGdldE5vcnRoKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xuICAgICAgICByZXR1cm4gYm91bmRzLmdldE5vcnRoKCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRTb3V0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRTb3V0aCgpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0V2VzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRXZXN0KCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRFYXN0KHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xuICAgICAgICByZXR1cm4gYm91bmRzLmdldEVhc3QoKTtcbiAgICB9XG4gICAgc3RhdGljIGdldFNxbUFyZWEocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgcG9seTogTC5Qb2x5Z29uID0gbmV3IEwuUG9seWdvbihwb2x5Z29uKTtcbiAgICAgICAgY29uc3QgZ2VvSnNvblBvbHkgPSBwb2x5LnRvR2VvSlNPTigpO1xuXG4gICAgICAgIGNvbnN0IGFyZWEgPSB0dXJmLmFyZWEoKGdlb0pzb25Qb2x5KSBhcyBhbnkpO1xuXG4gICAgICAgIHJldHVybiBhcmVhO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0UGVyaW1ldGVyKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHBvbHk6IEwuUG9seWdvbiA9IG5ldyBMLlBvbHlnb24ocG9seWdvbik7XG4gICAgICAgIGNvbnN0IGdlb0pzb25Qb2x5ID0gcG9seS50b0dlb0pTT04oKTtcblxuICAgICAgICBjb25zdCBwZXJpbWV0ZXIgPSB0dXJmLmxlbmd0aCgoZ2VvSnNvblBvbHkpIGFzIGFueSwge3VuaXRzOiBcIm1ldGVyc1wifSk7XG5cbiAgICAgICAgcmV0dXJuIHBlcmltZXRlcjtcbiAgICB9XG4gICAgc3RhdGljIGdldFBvbHlnb25DaGVja3N1bShwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCB1bmlxdWVMYXRMbmdzID0gcG9seWdvbi5maWx0ZXIoKHYsIGksIGEpID0+IHtcbiAgICAgICAgICAgIHJldHVybiBhLmluZGV4T2YoYS5maW5kKHggPT4geC5sYXQgPT09IHYubGF0ICYmIHgubG5nID09PSB2LmxuZykpID09PSBpO1xuICAgICAgICB9KTtcblxuICAgICAgICByZXR1cm4gdW5pcXVlTGF0TG5ncy5yZWR1Y2UoKGEsIGIpID0+ICthICsgK2IubGF0LCAwKSAqIHVuaXF1ZUxhdExuZ3MucmVkdWNlKChhLCBiKSA9PiArYSArICtiLmxuZywgMCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRNaWRQb2ludChwb2ludDE6IElMYXRMbmcsIHBvaW50MjogSUxhdExuZyk6IElMYXRMbmcge1xuXG4gICAgICAgIGNvbnN0IHAxID0gdHVyZi5wb2ludChbcG9pbnQxLmxuZywgcG9pbnQxLmxhdF0pO1xuICAgICAgICBjb25zdCBwMiA9IHR1cmYucG9pbnQoW3BvaW50Mi5sbmcsIHBvaW50Mi5sYXRdKTtcblxuICAgICAgICBjb25zdCBtaWRwb2ludCA9IHR1cmYubWlkcG9pbnQocDEsIHAyKTtcblxuICAgICAgICBjb25zdCByZXR1cm5Qb2ludDogSUxhdExuZyA9IHtcbiAgICAgICAgICAgIGxhdDogbWlkcG9pbnQuZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMV0sXG4gICAgICAgICAgICBsbmc6IG1pZHBvaW50Lmdlb21ldHJ5LmNvb3JkaW5hdGVzWzBdXG4gICAgICAgIH07XG5cbiAgICAgICAgcmV0dXJuIHJldHVyblBvaW50O1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0Qm91bmRzKHBvbHlnb246IElMYXRMbmdbXSk6IEwuTGF0TG5nQm91bmRzIHtcbiAgICAgICAgY29uc3QgdG1wTGF0TG5nOiBMLkxhdExuZ1tdID0gW107XG5cbiAgICAgICAgcG9seWdvbi5mb3JFYWNoKGxsID0+IHtcbiAgICAgICAgICAgIGlmIChpc05hTihsbC5sYXQpIHx8IGlzTmFOKGxsLmxuZykpIHtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHRtcExhdExuZy5wdXNoKGxsIGFzIEwuTGF0TG5nKTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgY29uc3QgcG9seUxpbmU6IEwuUG9seWxpbmUgPSBuZXcgTC5Qb2x5bGluZSh0bXBMYXRMbmcpO1xuICAgICAgICBjb25zdCBib3VuZHMgPSBwb2x5TGluZS5nZXRCb3VuZHMoKTtcblxuICAgICAgICByZXR1cm4gYm91bmRzO1xuXG4gICAgfVxufVxuXG4vL2V4cG9ydCBjbGFzcyBGcmVlZHJhd1N1YnRyYWN0IGV4dGVuZHMgTC5GcmVlRHJhdyB7XG5cblxuLy8gICAgY29uc3RydWN0b3IoKSB7XG5cbi8vICAgICAgICAvL3RoaXMgd2lsbCBiZWNvbWUgTC5GcmVlRHJhd1xuLy8gICAgICAgIHN1cGVyKG51bGwpO1xuLy8gICAgICAgIC8vY2FsbCBtZXRob2RzIGluIGZyZWVkcmF3IGJ5IHRoaXNcbi8vICAgICAgICBjb25zdCBmb28gPSB0aGlzLnNpemUoKTtcblxuLy8gICAgICAgIHRoaXMuY29uc29sZUxvZ051bWJlck9mUG9seWdvbnMoZm9vKTtcblxuLy8gICAgfVxuXG4vLyAgICBjb25zb2xlTG9nTnVtYmVyT2ZQb2x5Z29ucyhzaXplOiBudW1iZXIpOiB2b2lkIHtcbi8vICAgICAgICBjb25zb2xlLmxvZyhcIk51bWJlciBvZiBwb2x5Z29uczogXCIsIHNpemUpO1xuLy8gICAgfVxuXG4vL30iXX0=