import * as L from "leaflet";
import * as turf from "@turf/turf";
export class PolygonUtil {
    static getCenter(polygon) {
        const pi = Math.PI;
        let x = 0;
        let y = 0;
        let z = 0;
        polygon.forEach(v => {
            let lat1 = v.lat;
            let lon1 = v.lng;
            lat1 = lat1 * pi / 180;
            lon1 = lon1 * pi / 180;
            x += Math.cos(lat1) * Math.cos(lon1);
            y += Math.cos(lat1) * Math.sin(lon1);
            z += Math.sin(lat1);
        });
        let lng = Math.atan2(y, x);
        const hyp = Math.sqrt(x * x + y * y);
        let lat = Math.atan2(z, hyp);
        lat = lat * 180 / pi;
        lng = lng * 180 / pi;
        const center = { lat: lat, lng: lng };
        return center;
    }
    static getSouthWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    }
    static getNorthEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthEast();
    }
    static getNorthWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    }
    static getSouthEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getSouthEast();
    }
    static getNorth(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getNorth();
    }
    static getSouth(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getSouth();
    }
    static getWest(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getWest();
    }
    static getEast(polygon) {
        const bounds = this.getBounds(polygon);
        return bounds.getEast();
    }
    static getSqmArea(polygon) {
        const poly = new L.Polygon(polygon);
        const geoJsonPoly = poly.toGeoJSON();
        const area = turf.area((geoJsonPoly));
        return area;
    }
    static getPerimeter(polygon) {
        const poly = new L.Polygon(polygon);
        const geoJsonPoly = poly.toGeoJSON();
        const perimeter = turf.length((geoJsonPoly), { units: "meters" });
        return perimeter;
    }
    static getPolygonChecksum(polygon) {
        const uniqueLatLngs = polygon.filter((v, i, a) => {
            return a.indexOf(a.find(x => x.lat === v.lat && x.lng === v.lng)) === i;
        });
        return uniqueLatLngs.reduce((a, b) => +a + +b.lat, 0) * uniqueLatLngs.reduce((a, b) => +a + +b.lng, 0);
    }
    static getMidPoint(point1, point2) {
        const p1 = turf.point([point1.lng, point1.lat]);
        const p2 = turf.point([point2.lng, point2.lat]);
        const midpoint = turf.midpoint(p1, p2);
        const returnPoint = {
            lat: midpoint.geometry.coordinates[1],
            lng: midpoint.geometry.coordinates[0]
        };
        return returnPoint;
    }
    static getBounds(polygon) {
        const tmpLatLng = [];
        polygon.forEach(ll => {
            if (isNaN(ll.lat) || isNaN(ll.lng)) {
            }
            tmpLatLng.push(ll);
        });
        const polyLine = new L.Polyline(tmpLatLng);
        const bounds = polyLine.getBounds();
        return bounds;
    }
}
//export class FreedrawSubtract extends L.FreeDraw {
//    constructor() {
//        //this will become L.FreeDraw
//        super(null);
//        //call methods in freedraw by this
//        const foo = this.size();
//        this.consoleLogNumberOfPolygons(foo);
//    }
//    consoleLogNumberOfPolygons(size: number): void {
//        console.log("Number of polygons: ", size);
//    }
//}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWdvbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbXktbGliLyIsInNvdXJjZXMiOlsibGliL3BvbHlnb24udXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFNBQVMsQ0FBQztBQUM3QixPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQTtBQUdsQyxNQUFNLE9BQU8sV0FBVztJQUNwQixNQUFNLENBQUMsU0FBUyxDQUFDLE9BQWtCO1FBQy9CLE1BQU0sRUFBRSxHQUFHLElBQUksQ0FBQyxFQUFFLENBQUM7UUFDbkIsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBQ1YsSUFBSSxDQUFDLEdBQUcsQ0FBQyxDQUFDO1FBRVYsT0FBTyxDQUFDLE9BQU8sQ0FBQyxDQUFDLENBQUMsRUFBRTtZQUNoQixJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ2pCLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDakIsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUN2QixDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7UUFDeEIsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFJLEdBQUcsR0FBRyxJQUFJLENBQUMsS0FBSyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FB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QztRQUVoRCxNQUFNLFFBQVEsR0FBRyxJQUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUV2QyxNQUFNLFdBQVcsR0FBWTtZQUN6QixHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLEdBQUcsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7U0FDeEMsQ0FBQztRQUVGLE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFDRCxNQUFNLENBQUMsU0FBUyxDQUFDLE9BQWtCO1FBQy9CLE1BQU0sU0FBUyxHQUFlLEVBQUUsQ0FBQztRQUVqQyxPQUFPLENBQUMsT0FBTyxDQUFDLEVBQUUsQ0FBQyxFQUFFO1lBQ2pCLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFO2FBQ25DO1lBQ0QsU0FBUyxDQUFDLElBQUksQ0FBQyxFQUFjLENBQUMsQ0FBQztRQUNuQyxDQUFDLENBQUMsQ0FBQztRQUVILE1BQU0sUUFBUSxHQUFlLElBQUksQ0FBQyxDQUFDLFFBQVEsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUN2RCxNQUFNLE1BQU0sR0FBRyxRQUFRLENBQUMsU0FBUyxFQUFFLENBQUM7UUFFcEMsT0FBTyxNQUFNLENBQUM7SUFFbEIsQ0FBQztDQUNKO0FBRUQsb0RBQW9EO0FBR3BELHFCQUFxQjtBQUVyQix1Q0FBdUM7QUFDdkMsc0JBQXNCO0FBQ3RCLDRDQUE0QztBQUM1QyxrQ0FBa0M7QUFFbEMsK0NBQStDO0FBRS9DLE9BQU87QUFFUCxzREFBc0Q7QUFDdEQsb0RBQW9EO0FBQ3BELE9BQU87QUFFUCxHQUFHIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCAqIGFzIEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0ICogYXMgdHVyZiBmcm9tIFwiQHR1cmYvdHVyZlwiXHJcbmltcG9ydCB7IElMYXRMbmcgfSBmcm9tIFwiLi9wb2x5Z29uLWhlbHBlcnNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb2x5Z29uVXRpbCB7XHJcbiAgICBzdGF0aWMgZ2V0Q2VudGVyKHBvbHlnb246IElMYXRMbmdbXSkge1xyXG4gICAgICAgIGNvbnN0IHBpID0gTWF0aC5QSTtcclxuICAgICAgICBsZXQgeCA9IDA7XHJcbiAgICAgICAgbGV0IHkgPSAwO1xyXG4gICAgICAgIGxldCB6ID0gMDtcclxuXHJcbiAgICAgICAgcG9seWdvbi5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbGF0MSA9IHYubGF0O1xyXG4gICAgICAgICAgICBsZXQgbG9uMSA9IHYubG5nO1xyXG4gICAgICAgICAgICBsYXQxID0gbGF0MSAqIHBpIC8gMTgwO1xyXG4gICAgICAgICAgICBsb24xID0gbG9uMSAqIHBpIC8gMTgwO1xyXG4gICAgICAgICAgICB4ICs9IE1hdGguY29zKGxhdDEpICogTWF0aC5jb3MobG9uMSk7XHJcbiAgICAgICAgICAgIHkgKz0gTWF0aC5jb3MobGF0MSkgKiBNYXRoLnNpbihsb24xKTtcclxuICAgICAgICAgICAgeiArPSBNYXRoLnNpbihsYXQxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbGV0IGxuZyA9IE1hdGguYXRhbjIoeSwgeCk7XHJcbiAgICAgICAgY29uc3QgaHlwID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpO1xyXG4gICAgICAgIGxldCBsYXQgPSBNYXRoLmF0YW4yKHosIGh5cCk7XHJcbiAgICAgICAgbGF0ID0gbGF0ICogMTgwIC8gcGk7XHJcbiAgICAgICAgbG5nID0gbG5nICogMTgwIC8gcGk7XHJcbiAgICAgICAgY29uc3QgY2VudGVyOiBJTGF0TG5nID0geyBsYXQ6IGxhdCwgbG5nOiBsbmcgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNlbnRlcjtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aEVhc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRTb3V0aEVhc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGgoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0U291dGgoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRXZXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0RWFzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0RWFzdCgpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFNxbUFyZWEocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBwb2x5OiBMLlBvbHlnb24gPSBuZXcgTC5Qb2x5Z29uKHBvbHlnb24pO1xyXG4gICAgICAgIGNvbnN0IGdlb0pzb25Qb2x5ID0gcG9seS50b0dlb0pTT04oKTtcclxuXHJcbiAgICAgICAgY29uc3QgYXJlYSA9IHR1cmYuYXJlYSgoZ2VvSnNvblBvbHkpIGFzIGFueSk7XHJcblxyXG4gICAgICAgIHJldHVybiBhcmVhO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFBlcmltZXRlcihwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHBvbHk6IEwuUG9seWdvbiA9IG5ldyBMLlBvbHlnb24ocG9seWdvbik7XHJcbiAgICAgICAgY29uc3QgZ2VvSnNvblBvbHkgPSBwb2x5LnRvR2VvSlNPTigpO1xyXG5cclxuICAgICAgICBjb25zdCBwZXJpbWV0ZXIgPSB0dXJmLmxlbmd0aCgoZ2VvSnNvblBvbHkpIGFzIGFueSwge3VuaXRzOiBcIm1ldGVyc1wifSk7XHJcblxyXG4gICAgICAgIHJldHVybiBwZXJpbWV0ZXI7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0UG9seWdvbkNoZWNrc3VtKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgdW5pcXVlTGF0TG5ncyA9IHBvbHlnb24uZmlsdGVyKCh2LCBpLCBhKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLmluZGV4T2YoYS5maW5kKHggPT4geC5sYXQgPT09IHYubGF0ICYmIHgubG5nID09PSB2LmxuZykpID09PSBpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdW5pcXVlTGF0TG5ncy5yZWR1Y2UoKGEsIGIpID0+ICthICsgK2IubGF0LCAwKSAqIHVuaXF1ZUxhdExuZ3MucmVkdWNlKChhLCBiKSA9PiArYSArICtiLmxuZywgMCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0TWlkUG9pbnQocG9pbnQxOiBJTGF0TG5nLCBwb2ludDI6IElMYXRMbmcpOiBJTGF0TG5nIHtcclxuXHJcbiAgICAgICAgY29uc3QgcDEgPSB0dXJmLnBvaW50KFtwb2ludDEubG5nLCBwb2ludDEubGF0XSk7XHJcbiAgICAgICAgY29uc3QgcDIgPSB0dXJmLnBvaW50KFtwb2ludDIubG5nLCBwb2ludDIubGF0XSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1pZHBvaW50ID0gdHVyZi5taWRwb2ludChwMSwgcDIpO1xyXG5cclxuICAgICAgICBjb25zdCByZXR1cm5Qb2ludDogSUxhdExuZyA9IHtcclxuICAgICAgICAgICAgbGF0OiBtaWRwb2ludC5nZW9tZXRyeS5jb29yZGluYXRlc1sxXSxcclxuICAgICAgICAgICAgbG5nOiBtaWRwb2ludC5nZW9tZXRyeS5jb29yZGluYXRlc1swXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiByZXR1cm5Qb2ludDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRCb3VuZHMocG9seWdvbjogSUxhdExuZ1tdKTogTC5MYXRMbmdCb3VuZHMge1xyXG4gICAgICAgIGNvbnN0IHRtcExhdExuZzogTC5MYXRMbmdbXSA9IFtdO1xyXG5cclxuICAgICAgICBwb2x5Z29uLmZvckVhY2gobGwgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4obGwubGF0KSB8fCBpc05hTihsbC5sbmcpKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdG1wTGF0TG5nLnB1c2gobGwgYXMgTC5MYXRMbmcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwb2x5TGluZTogTC5Qb2x5bGluZSA9IG5ldyBMLlBvbHlsaW5lKHRtcExhdExuZyk7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gcG9seUxpbmUuZ2V0Qm91bmRzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZHM7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vL2V4cG9ydCBjbGFzcyBGcmVlZHJhd1N1YnRyYWN0IGV4dGVuZHMgTC5GcmVlRHJhdyB7XHJcblxyXG5cclxuLy8gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4vLyAgICAgICAgLy90aGlzIHdpbGwgYmVjb21lIEwuRnJlZURyYXdcclxuLy8gICAgICAgIHN1cGVyKG51bGwpO1xyXG4vLyAgICAgICAgLy9jYWxsIG1ldGhvZHMgaW4gZnJlZWRyYXcgYnkgdGhpc1xyXG4vLyAgICAgICAgY29uc3QgZm9vID0gdGhpcy5zaXplKCk7XHJcblxyXG4vLyAgICAgICAgdGhpcy5jb25zb2xlTG9nTnVtYmVyT2ZQb2x5Z29ucyhmb28pO1xyXG5cclxuLy8gICAgfVxyXG5cclxuLy8gICAgY29uc29sZUxvZ051bWJlck9mUG9seWdvbnMoc2l6ZTogbnVtYmVyKTogdm9pZCB7XHJcbi8vICAgICAgICBjb25zb2xlLmxvZyhcIk51bWJlciBvZiBwb2x5Z29uczogXCIsIHNpemUpO1xyXG4vLyAgICB9XHJcblxyXG4vL30iXX0=