import * as L from "leaflet";
import * as turf from "@turf/turf";
var PolygonUtil = /** @class */ (function () {
    function PolygonUtil() {
    }
    PolygonUtil.getCenter = function (polygon) {
        var pi = Math.PI;
        var x = 0;
        var y = 0;
        var z = 0;
        polygon.forEach(function (v) {
            var lat1 = v.lat;
            var lon1 = v.lng;
            lat1 = lat1 * pi / 180;
            lon1 = lon1 * pi / 180;
            x += Math.cos(lat1) * Math.cos(lon1);
            y += Math.cos(lat1) * Math.sin(lon1);
            z += Math.sin(lat1);
        });
        var lng = Math.atan2(y, x);
        var hyp = Math.sqrt(x * x + y * y);
        var lat = Math.atan2(z, hyp);
        lat = lat * 180 / pi;
        lng = lng * 180 / pi;
        var center = { lat: lat, lng: lng };
        return center;
    };
    PolygonUtil.getSouthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getNorthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthEast();
    };
    PolygonUtil.getNorthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getSouthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouthEast();
    };
    PolygonUtil.getNorth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorth();
    };
    PolygonUtil.getSouth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouth();
    };
    PolygonUtil.getWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getWest();
    };
    PolygonUtil.getEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getEast();
    };
    PolygonUtil.getSqmArea = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var area = turf.area((geoJsonPoly));
        return area;
    };
    PolygonUtil.getPerimeter = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var perimeter = turf.length((geoJsonPoly), { units: "meters" });
        return perimeter;
    };
    PolygonUtil.getPolygonChecksum = function (polygon) {
        var uniqueLatLngs = polygon.filter(function (v, i, a) {
            return a.indexOf(a.find(function (x) { return x.lat === v.lat && x.lng === v.lng; })) === i;
        });
        return uniqueLatLngs.reduce(function (a, b) { return +a + +b.lat; }, 0) * uniqueLatLngs.reduce(function (a, b) { return +a + +b.lng; }, 0);
    };
    PolygonUtil.getMidPoint = function (point1, point2) {
        var p1 = turf.point([point1.lng, point1.lat]);
        var p2 = turf.point([point2.lng, point2.lat]);
        var midpoint = turf.midpoint(p1, p2);
        var returnPoint = {
            lat: midpoint.geometry.coordinates[1],
            lng: midpoint.geometry.coordinates[0]
        };
        return returnPoint;
    };
    PolygonUtil.getBounds = function (polygon) {
        var tmpLatLng = [];
        polygon.forEach(function (ll) {
            if (isNaN(ll.lat) || isNaN(ll.lng)) {
            }
            tmpLatLng.push(ll);
        });
        var polyLine = new L.Polyline(tmpLatLng);
        var bounds = polyLine.getBounds();
        return bounds;
    };
    return PolygonUtil;
}());
export { PolygonUtil };
//export class FreedrawSubtract extends L.FreeDraw {
//    constructor() {
//        //this will become L.FreeDraw
//        super(null);
//        //call methods in freedraw by this
//        const foo = this.size();
//        this.consoleLogNumberOfPolygons(foo);
//    }
//    consoleLogNumberOfPolygons(size: number): void {
//        console.log("Number of polygons: ", size);
//    }
//}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWdvbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vcG9seWRyYXcvIiwic291cmNlcyI6WyJsaWIvcG9seWdvbi51dGlsLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBLE9BQU8sS0FBSyxDQUFDLE1BQU0sU0FBUyxDQUFDO0FBQzdCLE9BQU8sS0FBSyxJQUFJLE1BQU0sWUFBWSxDQUFBO0FBR2xDO0lBQUE7SUE4R0EsQ0FBQztJQTdHVSxxQkFBUyxHQUFoQixVQUFpQixPQUFrQjtRQUMvQixJQUFNLEVBQUUsR0FBRyxJQUFJLENBQUMsRUFBRSxDQUFDO1FBQ25CLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNWLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUVWLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxDQUFDO1lBQ2IsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNqQixJQUFJLElBQUksR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDO1lBQ2pCLElBQUksR0FBRyxJQUFJLEdBQUcsRUFBRSxHQUFHLEdBQUcsQ0FBQztZQUN2QixJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDdkIsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1lBQ3JDLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxDQUFDO1FBQ3hCLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBSSxHQUFHLEdBQUcsSUFBSSxDQUFDLEtBQUssQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFD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QUFJLENBQUMsUUFBUSxDQUFDLEVBQUUsRUFBRSxFQUFFLENBQUMsQ0FBQztRQUV2QyxJQUFNLFdBQVcsR0FBWTtZQUN6QixHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1lBQ3JDLEdBQUcsRUFBRSxRQUFRLENBQUMsUUFBUSxDQUFDLFdBQVcsQ0FBQyxDQUFDLENBQUM7U0FDeEMsQ0FBQztRQUVGLE9BQU8sV0FBVyxDQUFDO0lBQ3ZCLENBQUM7SUFDTSxxQkFBUyxHQUFoQixVQUFpQixPQUFrQjtRQUMvQixJQUFNLFNBQVMsR0FBZSxFQUFFLENBQUM7UUFFakMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxVQUFBLEVBQUU7WUFDZCxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLElBQUksS0FBSyxDQUFDLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRTthQUNuQztZQUNELFNBQVMsQ0FBQyxJQUFJLENBQUMsRUFBYyxDQUFDLENBQUM7UUFDbkMsQ0FBQyxDQUFDLENBQUM7UUFFSCxJQUFNLFFBQVEsR0FBZSxJQUFJLENBQUMsQ0FBQyxRQUFRLENBQUMsU0FBUyxDQUFDLENBQUM7UUFDdkQsSUFBTSxNQUFNLEdBQUcsUUFBUSxDQUFDLFNBQVMsRUFBRSxDQUFDO1FBRXBDLE9BQU8sTUFBTSxDQUFDO0lBRWxCLENBQUM7SUFDTCxrQkFBQztBQUFELENBQUMsQUE5R0QsSUE4R0M7O0FBRUQsb0RBQW9EO0FBR3BELHFCQUFxQjtBQUVyQix1Q0FBdUM7QUFDdkMsc0JBQXNCO0FBQ3RCLDRDQUE0QztBQUM1QyxrQ0FBa0M7QUFFbEMsK0NBQStDO0FBRS9DLE9BQU87QUFFUCxzREFBc0Q7QUFDdEQsb0RBQW9EO0FBQ3BELE9BQU87QUFFUCxHQUFHIiwic291cmNlc0NvbnRlbnQiOlsiXHJcbmltcG9ydCAqIGFzIEwgZnJvbSBcImxlYWZsZXRcIjtcclxuaW1wb3J0ICogYXMgdHVyZiBmcm9tIFwiQHR1cmYvdHVyZlwiXHJcbmltcG9ydCB7IElMYXRMbmcgfSBmcm9tIFwiLi9wb2x5Z29uLWhlbHBlcnNcIjtcclxuXHJcbmV4cG9ydCBjbGFzcyBQb2x5Z29uVXRpbCB7XHJcbiAgICBzdGF0aWMgZ2V0Q2VudGVyKHBvbHlnb246IElMYXRMbmdbXSkge1xyXG4gICAgICAgIGNvbnN0IHBpID0gTWF0aC5QSTtcclxuICAgICAgICBsZXQgeCA9IDA7XHJcbiAgICAgICAgbGV0IHkgPSAwO1xyXG4gICAgICAgIGxldCB6ID0gMDtcclxuXHJcbiAgICAgICAgcG9seWdvbi5mb3JFYWNoKHYgPT4ge1xyXG4gICAgICAgICAgICBsZXQgbGF0MSA9IHYubGF0O1xyXG4gICAgICAgICAgICBsZXQgbG9uMSA9IHYubG5nO1xyXG4gICAgICAgICAgICBsYXQxID0gbGF0MSAqIHBpIC8gMTgwO1xyXG4gICAgICAgICAgICBsb24xID0gbG9uMSAqIHBpIC8gMTgwO1xyXG4gICAgICAgICAgICB4ICs9IE1hdGguY29zKGxhdDEpICogTWF0aC5jb3MobG9uMSk7XHJcbiAgICAgICAgICAgIHkgKz0gTWF0aC5jb3MobGF0MSkgKiBNYXRoLnNpbihsb24xKTtcclxuICAgICAgICAgICAgeiArPSBNYXRoLnNpbihsYXQxKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbGV0IGxuZyA9IE1hdGguYXRhbjIoeSwgeCk7XHJcbiAgICAgICAgY29uc3QgaHlwID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpO1xyXG4gICAgICAgIGxldCBsYXQgPSBNYXRoLmF0YW4yKHosIGh5cCk7XHJcbiAgICAgICAgbGF0ID0gbGF0ICogMTgwIC8gcGk7XHJcbiAgICAgICAgbG5nID0gbG5nICogMTgwIC8gcGk7XHJcbiAgICAgICAgY29uc3QgY2VudGVyOiBJTGF0TG5nID0geyBsYXQ6IGxhdCwgbG5nOiBsbmcgfTtcclxuXHJcbiAgICAgICAgcmV0dXJuIGNlbnRlcjtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aEVhc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRTb3V0aEVhc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXROb3J0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGgoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTb3V0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0U291dGgoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XHJcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRXZXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0RWFzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0RWFzdCgpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFNxbUFyZWEocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBwb2x5OiBMLlBvbHlnb24gPSBuZXcgTC5Qb2x5Z29uKHBvbHlnb24pO1xyXG4gICAgICAgIGNvbnN0IGdlb0pzb25Qb2x5ID0gcG9seS50b0dlb0pTT04oKTtcclxuXHJcbiAgICAgICAgY29uc3QgYXJlYSA9IHR1cmYuYXJlYSgoZ2VvSnNvblBvbHkpIGFzIGFueSk7XHJcblxyXG4gICAgICAgIHJldHVybiBhcmVhO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFBlcmltZXRlcihwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHBvbHk6IEwuUG9seWdvbiA9IG5ldyBMLlBvbHlnb24ocG9seWdvbik7XHJcbiAgICAgICAgY29uc3QgZ2VvSnNvblBvbHkgPSBwb2x5LnRvR2VvSlNPTigpO1xyXG5cclxuICAgICAgICBjb25zdCBwZXJpbWV0ZXIgPSB0dXJmLmxlbmd0aCgoZ2VvSnNvblBvbHkpIGFzIGFueSwge3VuaXRzOiBcIm1ldGVyc1wifSk7XHJcblxyXG4gICAgICAgIHJldHVybiBwZXJpbWV0ZXI7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0UG9seWdvbkNoZWNrc3VtKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgdW5pcXVlTGF0TG5ncyA9IHBvbHlnb24uZmlsdGVyKCh2LCBpLCBhKSA9PiB7XHJcbiAgICAgICAgICAgIHJldHVybiBhLmluZGV4T2YoYS5maW5kKHggPT4geC5sYXQgPT09IHYubGF0ICYmIHgubG5nID09PSB2LmxuZykpID09PSBpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICByZXR1cm4gdW5pcXVlTGF0TG5ncy5yZWR1Y2UoKGEsIGIpID0+ICthICsgK2IubGF0LCAwKSAqIHVuaXF1ZUxhdExuZ3MucmVkdWNlKChhLCBiKSA9PiArYSArICtiLmxuZywgMCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0TWlkUG9pbnQocG9pbnQxOiBJTGF0TG5nLCBwb2ludDI6IElMYXRMbmcpOiBJTGF0TG5nIHtcclxuXHJcbiAgICAgICAgY29uc3QgcDEgPSB0dXJmLnBvaW50KFtwb2ludDEubG5nLCBwb2ludDEubGF0XSk7XHJcbiAgICAgICAgY29uc3QgcDIgPSB0dXJmLnBvaW50KFtwb2ludDIubG5nLCBwb2ludDIubGF0XSk7XHJcblxyXG4gICAgICAgIGNvbnN0IG1pZHBvaW50ID0gdHVyZi5taWRwb2ludChwMSwgcDIpO1xyXG5cclxuICAgICAgICBjb25zdCByZXR1cm5Qb2ludDogSUxhdExuZyA9IHtcclxuICAgICAgICAgICAgbGF0OiBtaWRwb2ludC5nZW9tZXRyeS5jb29yZGluYXRlc1sxXSxcclxuICAgICAgICAgICAgbG5nOiBtaWRwb2ludC5nZW9tZXRyeS5jb29yZGluYXRlc1swXVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJldHVybiByZXR1cm5Qb2ludDtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRCb3VuZHMocG9seWdvbjogSUxhdExuZ1tdKTogTC5MYXRMbmdCb3VuZHMge1xyXG4gICAgICAgIGNvbnN0IHRtcExhdExuZzogTC5MYXRMbmdbXSA9IFtdO1xyXG5cclxuICAgICAgICBwb2x5Z29uLmZvckVhY2gobGwgPT4ge1xyXG4gICAgICAgICAgICBpZiAoaXNOYU4obGwubGF0KSB8fCBpc05hTihsbC5sbmcpKSB7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdG1wTGF0TG5nLnB1c2gobGwgYXMgTC5MYXRMbmcpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBjb25zdCBwb2x5TGluZTogTC5Qb2x5bGluZSA9IG5ldyBMLlBvbHlsaW5lKHRtcExhdExuZyk7XHJcbiAgICAgICAgY29uc3QgYm91bmRzID0gcG9seUxpbmUuZ2V0Qm91bmRzKCk7XHJcblxyXG4gICAgICAgIHJldHVybiBib3VuZHM7XHJcblxyXG4gICAgfVxyXG59XHJcblxyXG4vL2V4cG9ydCBjbGFzcyBGcmVlZHJhd1N1YnRyYWN0IGV4dGVuZHMgTC5GcmVlRHJhdyB7XHJcblxyXG5cclxuLy8gICAgY29uc3RydWN0b3IoKSB7XHJcblxyXG4vLyAgICAgICAgLy90aGlzIHdpbGwgYmVjb21lIEwuRnJlZURyYXdcclxuLy8gICAgICAgIHN1cGVyKG51bGwpO1xyXG4vLyAgICAgICAgLy9jYWxsIG1ldGhvZHMgaW4gZnJlZWRyYXcgYnkgdGhpc1xyXG4vLyAgICAgICAgY29uc3QgZm9vID0gdGhpcy5zaXplKCk7XHJcblxyXG4vLyAgICAgICAgdGhpcy5jb25zb2xlTG9nTnVtYmVyT2ZQb2x5Z29ucyhmb28pO1xyXG5cclxuLy8gICAgfVxyXG5cclxuLy8gICAgY29uc29sZUxvZ051bWJlck9mUG9seWdvbnMoc2l6ZTogbnVtYmVyKTogdm9pZCB7XHJcbi8vICAgICAgICBjb25zb2xlLmxvZyhcIk51bWJlciBvZiBwb2x5Z29uczogXCIsIHNpemUpO1xyXG4vLyAgICB9XHJcblxyXG4vL30iXX0=