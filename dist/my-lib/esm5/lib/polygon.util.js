import * as L from "leaflet";
import * as turf from "@turf/turf";
var PolygonUtil = /** @class */ (function () {
    function PolygonUtil() {
    }
    PolygonUtil.getCenter = function (polygon) {
        var pi = Math.PI;
        var x = 0;
        var y = 0;
        var z = 0;
        polygon.forEach(function (v) {
            var lat1 = v.lat;
            var lon1 = v.lng;
            lat1 = lat1 * pi / 180;
            lon1 = lon1 * pi / 180;
            x += Math.cos(lat1) * Math.cos(lon1);
            y += Math.cos(lat1) * Math.sin(lon1);
            z += Math.sin(lat1);
        });
        var lng = Math.atan2(y, x);
        var hyp = Math.sqrt(x * x + y * y);
        var lat = Math.atan2(z, hyp);
        lat = lat * 180 / pi;
        lng = lng * 180 / pi;
        var center = { lat: lat, lng: lng };
        return center;
    };
    PolygonUtil.getSouthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getNorthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthEast();
    };
    PolygonUtil.getNorthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getSouthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouthEast();
    };
    PolygonUtil.getNorth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorth();
    };
    PolygonUtil.getSouth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouth();
    };
    PolygonUtil.getWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getWest();
    };
    PolygonUtil.getEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getEast();
    };
    PolygonUtil.getSqmArea = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var area = turf.area((geoJsonPoly));
        return area;
    };
    PolygonUtil.getPerimeter = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var perimeter = turf.length((geoJsonPoly), { units: "meters" });
        return perimeter;
    };
    PolygonUtil.getPolygonChecksum = function (polygon) {
        var uniqueLatLngs = polygon.filter(function (v, i, a) {
            return a.indexOf(a.find(function (x) { return x.lat === v.lat && x.lng === v.lng; })) === i;
        });
        return uniqueLatLngs.reduce(function (a, b) { return +a + +b.lat; }, 0) * uniqueLatLngs.reduce(function (a, b) { return +a + +b.lng; }, 0);
    };
    PolygonUtil.getMidPoint = function (point1, point2) {
        var p1 = turf.point([point1.lng, point1.lat]);
        var p2 = turf.point([point2.lng, point2.lat]);
        var midpoint = turf.midpoint(p1, p2);
        var returnPoint = {
            lat: midpoint.geometry.coordinates[1],
            lng: midpoint.geometry.coordinates[0]
        };
        return returnPoint;
    };
    PolygonUtil.getBounds = function (polygon) {
        var tmpLatLng = [];
        polygon.forEach(function (ll) {
            if (isNaN(ll.lat) || isNaN(ll.lng)) {
            }
            tmpLatLng.push(ll);
        });
        var polyLine = new L.Polyline(tmpLatLng);
        var bounds = polyLine.getBounds();
        return bounds;
    };
    return PolygonUtil;
}());
export { PolygonUtil };
//export class FreedrawSubtract extends L.FreeDraw {
//    constructor() {
//        //this will become L.FreeDraw
//        super(null);
//        //call methods in freedraw by this
//        const foo = this.size();
//        this.consoleLogNumberOfPolygons(foo);
//    }
//    consoleLogNumberOfPolygons(size: number): void {
//        console.log("Number of polygons: ", size);
//    }
//}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWdvbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbXktbGliLyIsInNvdXJjZXMiOlsibGliL3BvbHlnb24udXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFNBQVMsQ0FBQztBQUM3QixPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQTtBQUdsQztJQUFBO0lBOEdBLENBQUM7SUE3R1UscUJBQVMsR0FBaEIsVUFBaUIsT0FBa0I7UUFDL0IsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFVixPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztZQUNiLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDakIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNqQixJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDdkIsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNC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SSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFdkMsSUFBTSxXQUFXLEdBQVk7WUFDekIsR0FBRyxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNyQyxHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1NBQ3hDLENBQUM7UUFFRixPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDO0lBQ00scUJBQVMsR0FBaEIsVUFBaUIsT0FBa0I7UUFDL0IsSUFBTSxTQUFTLEdBQWUsRUFBRSxDQUFDO1FBRWpDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxFQUFFO1lBQ2QsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUU7YUFDbkM7WUFDRCxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQWMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBTSxRQUFRLEdBQWUsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZELElBQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUVwQyxPQUFPLE1BQU0sQ0FBQztJQUVsQixDQUFDO0lBQ0wsa0JBQUM7QUFBRCxDQUFDLEFBOUdELElBOEdDOztBQUVELG9EQUFvRDtBQUdwRCxxQkFBcUI7QUFFckIsdUNBQXVDO0FBQ3ZDLHNCQUFzQjtBQUN0Qiw0Q0FBNEM7QUFDNUMsa0NBQWtDO0FBRWxDLCtDQUErQztBQUUvQyxPQUFPO0FBRVAsc0RBQXNEO0FBQ3RELG9EQUFvRDtBQUNwRCxPQUFPO0FBRVAsR0FBRyIsInNvdXJjZXNDb250ZW50IjpbIlxyXG5pbXBvcnQgKiBhcyBMIGZyb20gXCJsZWFmbGV0XCI7XHJcbmltcG9ydCAqIGFzIHR1cmYgZnJvbSBcIkB0dXJmL3R1cmZcIlxyXG5pbXBvcnQgeyBJTGF0TG5nIH0gZnJvbSBcIi4vcG9seWdvbi1oZWxwZXJzXCI7XHJcblxyXG5leHBvcnQgY2xhc3MgUG9seWdvblV0aWwge1xyXG4gICAgc3RhdGljIGdldENlbnRlcihwb2x5Z29uOiBJTGF0TG5nW10pIHtcclxuICAgICAgICBjb25zdCBwaSA9IE1hdGguUEk7XHJcbiAgICAgICAgbGV0IHggPSAwO1xyXG4gICAgICAgIGxldCB5ID0gMDtcclxuICAgICAgICBsZXQgeiA9IDA7XHJcblxyXG4gICAgICAgIHBvbHlnb24uZm9yRWFjaCh2ID0+IHtcclxuICAgICAgICAgICAgbGV0IGxhdDEgPSB2LmxhdDtcclxuICAgICAgICAgICAgbGV0IGxvbjEgPSB2LmxuZztcclxuICAgICAgICAgICAgbGF0MSA9IGxhdDEgKiBwaSAvIDE4MDtcclxuICAgICAgICAgICAgbG9uMSA9IGxvbjEgKiBwaSAvIDE4MDtcclxuICAgICAgICAgICAgeCArPSBNYXRoLmNvcyhsYXQxKSAqIE1hdGguY29zKGxvbjEpO1xyXG4gICAgICAgICAgICB5ICs9IE1hdGguY29zKGxhdDEpICogTWF0aC5zaW4obG9uMSk7XHJcbiAgICAgICAgICAgIHogKz0gTWF0aC5zaW4obGF0MSk7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIGxldCBsbmcgPSBNYXRoLmF0YW4yKHksIHgpO1xyXG4gICAgICAgIGNvbnN0IGh5cCA9IE1hdGguc3FydCh4ICogeCArIHkgKiB5KTtcclxuICAgICAgICBsZXQgbGF0ID0gTWF0aC5hdGFuMih6LCBoeXApO1xyXG4gICAgICAgIGxhdCA9IGxhdCAqIDE4MCAvIHBpO1xyXG4gICAgICAgIGxuZyA9IGxuZyAqIDE4MCAvIHBpO1xyXG4gICAgICAgIGNvbnN0IGNlbnRlcjogSUxhdExuZyA9IHsgbGF0OiBsYXQsIGxuZzogbG5nIH07XHJcblxyXG4gICAgICAgIHJldHVybiBjZW50ZXI7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0U291dGhXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0Tm9ydGhFYXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGhFYXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0Tm9ydGhXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0U291dGhFYXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0U291dGhFYXN0KCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0Tm9ydGgocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcclxuICAgICAgICByZXR1cm4gYm91bmRzLmdldE5vcnRoKCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0U291dGgocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcclxuICAgICAgICByZXR1cm4gYm91bmRzLmdldFNvdXRoKCk7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0V2VzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xyXG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0V2VzdCgpO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcclxuICAgICAgICByZXR1cm4gYm91bmRzLmdldEVhc3QoKTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRTcW1BcmVhKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XHJcbiAgICAgICAgY29uc3QgcG9seTogTC5Qb2x5Z29uID0gbmV3IEwuUG9seWdvbihwb2x5Z29uKTtcclxuICAgICAgICBjb25zdCBnZW9Kc29uUG9seSA9IHBvbHkudG9HZW9KU09OKCk7XHJcblxyXG4gICAgICAgIGNvbnN0IGFyZWEgPSB0dXJmLmFyZWEoKGdlb0pzb25Qb2x5KSBhcyBhbnkpO1xyXG5cclxuICAgICAgICByZXR1cm4gYXJlYTtcclxuICAgIH1cclxuICAgIHN0YXRpYyBnZXRQZXJpbWV0ZXIocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcclxuICAgICAgICBjb25zdCBwb2x5OiBMLlBvbHlnb24gPSBuZXcgTC5Qb2x5Z29uKHBvbHlnb24pO1xyXG4gICAgICAgIGNvbnN0IGdlb0pzb25Qb2x5ID0gcG9seS50b0dlb0pTT04oKTtcclxuXHJcbiAgICAgICAgY29uc3QgcGVyaW1ldGVyID0gdHVyZi5sZW5ndGgoKGdlb0pzb25Qb2x5KSBhcyBhbnksIHt1bml0czogXCJtZXRlcnNcIn0pO1xyXG5cclxuICAgICAgICByZXR1cm4gcGVyaW1ldGVyO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldFBvbHlnb25DaGVja3N1bShwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xyXG4gICAgICAgIGNvbnN0IHVuaXF1ZUxhdExuZ3MgPSBwb2x5Z29uLmZpbHRlcigodiwgaSwgYSkgPT4ge1xyXG4gICAgICAgICAgICByZXR1cm4gYS5pbmRleE9mKGEuZmluZCh4ID0+IHgubGF0ID09PSB2LmxhdCAmJiB4LmxuZyA9PT0gdi5sbmcpKSA9PT0gaTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgcmV0dXJuIHVuaXF1ZUxhdExuZ3MucmVkdWNlKChhLCBiKSA9PiArYSArICtiLmxhdCwgMCkgKiB1bmlxdWVMYXRMbmdzLnJlZHVjZSgoYSwgYikgPT4gK2EgKyArYi5sbmcsIDApO1xyXG4gICAgfVxyXG4gICAgc3RhdGljIGdldE1pZFBvaW50KHBvaW50MTogSUxhdExuZywgcG9pbnQyOiBJTGF0TG5nKTogSUxhdExuZyB7XHJcblxyXG4gICAgICAgIGNvbnN0IHAxID0gdHVyZi5wb2ludChbcG9pbnQxLmxuZywgcG9pbnQxLmxhdF0pO1xyXG4gICAgICAgIGNvbnN0IHAyID0gdHVyZi5wb2ludChbcG9pbnQyLmxuZywgcG9pbnQyLmxhdF0pO1xyXG5cclxuICAgICAgICBjb25zdCBtaWRwb2ludCA9IHR1cmYubWlkcG9pbnQocDEsIHAyKTtcclxuXHJcbiAgICAgICAgY29uc3QgcmV0dXJuUG9pbnQ6IElMYXRMbmcgPSB7XHJcbiAgICAgICAgICAgIGxhdDogbWlkcG9pbnQuZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMV0sXHJcbiAgICAgICAgICAgIGxuZzogbWlkcG9pbnQuZ2VvbWV0cnkuY29vcmRpbmF0ZXNbMF1cclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICByZXR1cm4gcmV0dXJuUG9pbnQ7XHJcbiAgICB9XHJcbiAgICBzdGF0aWMgZ2V0Qm91bmRzKHBvbHlnb246IElMYXRMbmdbXSk6IEwuTGF0TG5nQm91bmRzIHtcclxuICAgICAgICBjb25zdCB0bXBMYXRMbmc6IEwuTGF0TG5nW10gPSBbXTtcclxuXHJcbiAgICAgICAgcG9seWdvbi5mb3JFYWNoKGxsID0+IHtcclxuICAgICAgICAgICAgaWYgKGlzTmFOKGxsLmxhdCkgfHwgaXNOYU4obGwubG5nKSkge1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRtcExhdExuZy5wdXNoKGxsIGFzIEwuTGF0TG5nKTtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgY29uc3QgcG9seUxpbmU6IEwuUG9seWxpbmUgPSBuZXcgTC5Qb2x5bGluZSh0bXBMYXRMbmcpO1xyXG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHBvbHlMaW5lLmdldEJvdW5kcygpO1xyXG5cclxuICAgICAgICByZXR1cm4gYm91bmRzO1xyXG5cclxuICAgIH1cclxufVxyXG5cclxuLy9leHBvcnQgY2xhc3MgRnJlZWRyYXdTdWJ0cmFjdCBleHRlbmRzIEwuRnJlZURyYXcge1xyXG5cclxuXHJcbi8vICAgIGNvbnN0cnVjdG9yKCkge1xyXG5cclxuLy8gICAgICAgIC8vdGhpcyB3aWxsIGJlY29tZSBMLkZyZWVEcmF3XHJcbi8vICAgICAgICBzdXBlcihudWxsKTtcclxuLy8gICAgICAgIC8vY2FsbCBtZXRob2RzIGluIGZyZWVkcmF3IGJ5IHRoaXNcclxuLy8gICAgICAgIGNvbnN0IGZvbyA9IHRoaXMuc2l6ZSgpO1xyXG5cclxuLy8gICAgICAgIHRoaXMuY29uc29sZUxvZ051bWJlck9mUG9seWdvbnMoZm9vKTtcclxuXHJcbi8vICAgIH1cclxuXHJcbi8vICAgIGNvbnNvbGVMb2dOdW1iZXJPZlBvbHlnb25zKHNpemU6IG51bWJlcik6IHZvaWQge1xyXG4vLyAgICAgICAgY29uc29sZS5sb2coXCJOdW1iZXIgb2YgcG9seWdvbnM6IFwiLCBzaXplKTtcclxuLy8gICAgfVxyXG5cclxuLy99Il19