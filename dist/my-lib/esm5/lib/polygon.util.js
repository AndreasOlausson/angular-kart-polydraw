import * as L from "leaflet";
import * as turf from "@turf/turf";
var PolygonUtil = /** @class */ (function () {
    function PolygonUtil() {
    }
    PolygonUtil.getCenter = function (polygon) {
        var pi = Math.PI;
        var x = 0;
        var y = 0;
        var z = 0;
        polygon.forEach(function (v) {
            var lat1 = v.lat;
            var lon1 = v.lng;
            lat1 = lat1 * pi / 180;
            lon1 = lon1 * pi / 180;
            x += Math.cos(lat1) * Math.cos(lon1);
            y += Math.cos(lat1) * Math.sin(lon1);
            z += Math.sin(lat1);
        });
        var lng = Math.atan2(y, x);
        var hyp = Math.sqrt(x * x + y * y);
        var lat = Math.atan2(z, hyp);
        lat = lat * 180 / pi;
        lng = lng * 180 / pi;
        var center = { lat: lat, lng: lng };
        return center;
    };
    PolygonUtil.getSouthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getNorthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthEast();
    };
    PolygonUtil.getNorthWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorthWest();
    };
    PolygonUtil.getSouthEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouthEast();
    };
    PolygonUtil.getNorth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getNorth();
    };
    PolygonUtil.getSouth = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getSouth();
    };
    PolygonUtil.getWest = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getWest();
    };
    PolygonUtil.getEast = function (polygon) {
        var bounds = this.getBounds(polygon);
        return bounds.getEast();
    };
    PolygonUtil.getSqmArea = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var area = turf.area((geoJsonPoly));
        return area;
    };
    PolygonUtil.getPerimeter = function (polygon) {
        var poly = new L.Polygon(polygon);
        var geoJsonPoly = poly.toGeoJSON();
        var perimeter = turf.length((geoJsonPoly), { units: "meters" });
        return perimeter;
    };
    PolygonUtil.getPolygonChecksum = function (polygon) {
        var uniqueLatLngs = polygon.filter(function (v, i, a) {
            return a.indexOf(a.find(function (x) { return x.lat === v.lat && x.lng === v.lng; })) === i;
        });
        return uniqueLatLngs.reduce(function (a, b) { return +a + +b.lat; }, 0) * uniqueLatLngs.reduce(function (a, b) { return +a + +b.lng; }, 0);
    };
    PolygonUtil.getMidPoint = function (point1, point2) {
        var p1 = turf.point([point1.lng, point1.lat]);
        var p2 = turf.point([point2.lng, point2.lat]);
        var midpoint = turf.midpoint(p1, p2);
        var returnPoint = {
            lat: midpoint.geometry.coordinates[1],
            lng: midpoint.geometry.coordinates[0]
        };
        return returnPoint;
    };
    PolygonUtil.getBounds = function (polygon) {
        var tmpLatLng = [];
        polygon.forEach(function (ll) {
            if (isNaN(ll.lat) || isNaN(ll.lng)) {
            }
            tmpLatLng.push(ll);
        });
        var polyLine = new L.Polyline(tmpLatLng);
        var bounds = polyLine.getBounds();
        return bounds;
    };
    return PolygonUtil;
}());
export { PolygonUtil };
//export class FreedrawSubtract extends L.FreeDraw {
//    constructor() {
//        //this will become L.FreeDraw
//        super(null);
//        //call methods in freedraw by this
//        const foo = this.size();
//        this.consoleLogNumberOfPolygons(foo);
//    }
//    consoleLogNumberOfPolygons(size: number): void {
//        console.log("Number of polygons: ", size);
//    }
//}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicG9seWdvbi51dGlsLmpzIiwic291cmNlUm9vdCI6Im5nOi8vbXktbGliLyIsInNvdXJjZXMiOlsibGliL3BvbHlnb24udXRpbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFDQSxPQUFPLEtBQUssQ0FBQyxNQUFNLFNBQVMsQ0FBQztBQUM3QixPQUFPLEtBQUssSUFBSSxNQUFNLFlBQVksQ0FBQTtBQUdsQztJQUFBO0lBOEdBLENBQUM7SUE3R1UscUJBQVMsR0FBaEIsVUFBaUIsT0FBa0I7UUFDL0IsSUFBTSxFQUFFLEdBQUcsSUFBSSxDQUFDLEVBQUUsQ0FBQztRQUNuQixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFDVixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUM7UUFFVixPQUFPLENBQUMsT0FBTyxDQUFDLFVBQUEsQ0FBQztZQUNiLElBQUksSUFBSSxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUM7WUFDakIsSUFBSSxJQUFJLEdBQUcsQ0FBQyxDQUFDLEdBQUcsQ0FBQztZQUNqQixJQUFJLEdBQUcsSUFBSSxHQUFHLEVBQUUsR0FBRyxHQUFHLENBQUM7WUFDdkIsSUFBSSxHQUFHLElBQUksR0FBRyxFQUFFLEdBQUcsR0FBRyxDQUFDO1lBQ3ZCLENBQUMsSUFBSSxJQUFJLENBQUMsR0FBRyxDQUFDLElBQUksQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLENBQUM7WUFDckMsQ0FBQyxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztZQUNyQyxDQUFDLElBQUksSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsQ0FBQztRQUN4QixDQUFDLENBQUMsQ0FBQztRQUVILElBQUksR0FBRyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQzNC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SSxDQUFDLFFBQVEsQ0FBQyxFQUFFLEVBQUUsRUFBRSxDQUFDLENBQUM7UUFFdkMsSUFBTSxXQUFXLEdBQVk7WUFDekIsR0FBRyxFQUFFLFFBQVEsQ0FBQyxRQUFRLENBQUMsV0FBVyxDQUFDLENBQUMsQ0FBQztZQUNyQyxHQUFHLEVBQUUsUUFBUSxDQUFDLFFBQVEsQ0FBQyxXQUFXLENBQUMsQ0FBQyxDQUFDO1NBQ3hDLENBQUM7UUFFRixPQUFPLFdBQVcsQ0FBQztJQUN2QixDQUFDO0lBQ00scUJBQVMsR0FBaEIsVUFBaUIsT0FBa0I7UUFDL0IsSUFBTSxTQUFTLEdBQWUsRUFBRSxDQUFDO1FBRWpDLE9BQU8sQ0FBQyxPQUFPLENBQUMsVUFBQSxFQUFFO1lBQ2QsSUFBSSxLQUFLLENBQUMsRUFBRSxDQUFDLEdBQUcsQ0FBQyxJQUFJLEtBQUssQ0FBQyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUU7YUFDbkM7WUFDRCxTQUFTLENBQUMsSUFBSSxDQUFDLEVBQWMsQ0FBQyxDQUFDO1FBQ25DLENBQUMsQ0FBQyxDQUFDO1FBRUgsSUFBTSxRQUFRLEdBQWUsSUFBSSxDQUFDLENBQUMsUUFBUSxDQUFDLFNBQVMsQ0FBQyxDQUFDO1FBQ3ZELElBQU0sTUFBTSxHQUFHLFFBQVEsQ0FBQyxTQUFTLEVBQUUsQ0FBQztRQUVwQyxPQUFPLE1BQU0sQ0FBQztJQUVsQixDQUFDO0lBQ0wsa0JBQUM7QUFBRCxDQUFDLEFBOUdELElBOEdDOztBQUVELG9EQUFvRDtBQUdwRCxxQkFBcUI7QUFFckIsdUNBQXVDO0FBQ3ZDLHNCQUFzQjtBQUN0Qiw0Q0FBNEM7QUFDNUMsa0NBQWtDO0FBRWxDLCtDQUErQztBQUUvQyxPQUFPO0FBRVAsc0RBQXNEO0FBQ3RELG9EQUFvRDtBQUNwRCxPQUFPO0FBRVAsR0FBRyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0ICogYXMgTCBmcm9tIFwibGVhZmxldFwiO1xuaW1wb3J0ICogYXMgdHVyZiBmcm9tIFwiQHR1cmYvdHVyZlwiXG5pbXBvcnQgeyBJTGF0TG5nIH0gZnJvbSBcIi4vcG9seWdvbi1oZWxwZXJzXCI7XG5cbmV4cG9ydCBjbGFzcyBQb2x5Z29uVXRpbCB7XG4gICAgc3RhdGljIGdldENlbnRlcihwb2x5Z29uOiBJTGF0TG5nW10pIHtcbiAgICAgICAgY29uc3QgcGkgPSBNYXRoLlBJO1xuICAgICAgICBsZXQgeCA9IDA7XG4gICAgICAgIGxldCB5ID0gMDtcbiAgICAgICAgbGV0IHogPSAwO1xuXG4gICAgICAgIHBvbHlnb24uZm9yRWFjaCh2ID0+IHtcbiAgICAgICAgICAgIGxldCBsYXQxID0gdi5sYXQ7XG4gICAgICAgICAgICBsZXQgbG9uMSA9IHYubG5nO1xuICAgICAgICAgICAgbGF0MSA9IGxhdDEgKiBwaSAvIDE4MDtcbiAgICAgICAgICAgIGxvbjEgPSBsb24xICogcGkgLyAxODA7XG4gICAgICAgICAgICB4ICs9IE1hdGguY29zKGxhdDEpICogTWF0aC5jb3MobG9uMSk7XG4gICAgICAgICAgICB5ICs9IE1hdGguY29zKGxhdDEpICogTWF0aC5zaW4obG9uMSk7XG4gICAgICAgICAgICB6ICs9IE1hdGguc2luKGxhdDEpO1xuICAgICAgICB9KTtcblxuICAgICAgICBsZXQgbG5nID0gTWF0aC5hdGFuMih5LCB4KTtcbiAgICAgICAgY29uc3QgaHlwID0gTWF0aC5zcXJ0KHggKiB4ICsgeSAqIHkpO1xuICAgICAgICBsZXQgbGF0ID0gTWF0aC5hdGFuMih6LCBoeXApO1xuICAgICAgICBsYXQgPSBsYXQgKiAxODAgLyBwaTtcbiAgICAgICAgbG5nID0gbG5nICogMTgwIC8gcGk7XG4gICAgICAgIGNvbnN0IGNlbnRlcjogSUxhdExuZyA9IHsgbGF0OiBsYXQsIGxuZzogbG5nIH07XG5cbiAgICAgICAgcmV0dXJuIGNlbnRlcjtcbiAgICB9XG4gICAgc3RhdGljIGdldFNvdXRoV2VzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBJTGF0TG5nIHtcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0Tm9ydGhXZXN0KCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXROb3J0aEVhc3QocG9seWdvbjogSUxhdExuZ1tdKTogSUxhdExuZyB7XG4gICAgICAgIGNvbnN0IGJvdW5kcyA9IHRoaXMuZ2V0Qm91bmRzKHBvbHlnb24pO1xuICAgICAgICByZXR1cm4gYm91bmRzLmdldE5vcnRoRWFzdCgpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0Tm9ydGhXZXN0KHBvbHlnb246IElMYXRMbmdbXSk6IElMYXRMbmcge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aFdlc3QoKTtcbiAgICB9XG4gICAgc3RhdGljIGdldFNvdXRoRWFzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBJTGF0TG5nIHtcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0U291dGhFYXN0KCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXROb3J0aChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXROb3J0aCgpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0U291dGgocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0U291dGgoKTtcbiAgICB9XG4gICAgc3RhdGljIGdldFdlc3QocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgYm91bmRzID0gdGhpcy5nZXRCb3VuZHMocG9seWdvbik7XG4gICAgICAgIHJldHVybiBib3VuZHMuZ2V0V2VzdCgpO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0RWFzdChwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBib3VuZHMgPSB0aGlzLmdldEJvdW5kcyhwb2x5Z29uKTtcbiAgICAgICAgcmV0dXJuIGJvdW5kcy5nZXRFYXN0KCk7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRTcW1BcmVhKHBvbHlnb246IElMYXRMbmdbXSk6IG51bWJlciB7XG4gICAgICAgIGNvbnN0IHBvbHk6IEwuUG9seWdvbiA9IG5ldyBMLlBvbHlnb24ocG9seWdvbik7XG4gICAgICAgIGNvbnN0IGdlb0pzb25Qb2x5ID0gcG9seS50b0dlb0pTT04oKTtcblxuICAgICAgICBjb25zdCBhcmVhID0gdHVyZi5hcmVhKChnZW9Kc29uUG9seSkgYXMgYW55KTtcblxuICAgICAgICByZXR1cm4gYXJlYTtcbiAgICB9XG4gICAgc3RhdGljIGdldFBlcmltZXRlcihwb2x5Z29uOiBJTGF0TG5nW10pOiBudW1iZXIge1xuICAgICAgICBjb25zdCBwb2x5OiBMLlBvbHlnb24gPSBuZXcgTC5Qb2x5Z29uKHBvbHlnb24pO1xuICAgICAgICBjb25zdCBnZW9Kc29uUG9seSA9IHBvbHkudG9HZW9KU09OKCk7XG5cbiAgICAgICAgY29uc3QgcGVyaW1ldGVyID0gdHVyZi5sZW5ndGgoKGdlb0pzb25Qb2x5KSBhcyBhbnksIHt1bml0czogXCJtZXRlcnNcIn0pO1xuXG4gICAgICAgIHJldHVybiBwZXJpbWV0ZXI7XG4gICAgfVxuICAgIHN0YXRpYyBnZXRQb2x5Z29uQ2hlY2tzdW0ocG9seWdvbjogSUxhdExuZ1tdKTogbnVtYmVyIHtcbiAgICAgICAgY29uc3QgdW5pcXVlTGF0TG5ncyA9IHBvbHlnb24uZmlsdGVyKCh2LCBpLCBhKSA9PiB7XG4gICAgICAgICAgICByZXR1cm4gYS5pbmRleE9mKGEuZmluZCh4ID0+IHgubGF0ID09PSB2LmxhdCAmJiB4LmxuZyA9PT0gdi5sbmcpKSA9PT0gaTtcbiAgICAgICAgfSk7XG5cbiAgICAgICAgcmV0dXJuIHVuaXF1ZUxhdExuZ3MucmVkdWNlKChhLCBiKSA9PiArYSArICtiLmxhdCwgMCkgKiB1bmlxdWVMYXRMbmdzLnJlZHVjZSgoYSwgYikgPT4gK2EgKyArYi5sbmcsIDApO1xuICAgIH1cbiAgICBzdGF0aWMgZ2V0TWlkUG9pbnQocG9pbnQxOiBJTGF0TG5nLCBwb2ludDI6IElMYXRMbmcpOiBJTGF0TG5nIHtcblxuICAgICAgICBjb25zdCBwMSA9IHR1cmYucG9pbnQoW3BvaW50MS5sbmcsIHBvaW50MS5sYXRdKTtcbiAgICAgICAgY29uc3QgcDIgPSB0dXJmLnBvaW50KFtwb2ludDIubG5nLCBwb2ludDIubGF0XSk7XG5cbiAgICAgICAgY29uc3QgbWlkcG9pbnQgPSB0dXJmLm1pZHBvaW50KHAxLCBwMik7XG5cbiAgICAgICAgY29uc3QgcmV0dXJuUG9pbnQ6IElMYXRMbmcgPSB7XG4gICAgICAgICAgICBsYXQ6IG1pZHBvaW50Lmdlb21ldHJ5LmNvb3JkaW5hdGVzWzFdLFxuICAgICAgICAgICAgbG5nOiBtaWRwb2ludC5nZW9tZXRyeS5jb29yZGluYXRlc1swXVxuICAgICAgICB9O1xuXG4gICAgICAgIHJldHVybiByZXR1cm5Qb2ludDtcbiAgICB9XG4gICAgc3RhdGljIGdldEJvdW5kcyhwb2x5Z29uOiBJTGF0TG5nW10pOiBMLkxhdExuZ0JvdW5kcyB7XG4gICAgICAgIGNvbnN0IHRtcExhdExuZzogTC5MYXRMbmdbXSA9IFtdO1xuXG4gICAgICAgIHBvbHlnb24uZm9yRWFjaChsbCA9PiB7XG4gICAgICAgICAgICBpZiAoaXNOYU4obGwubGF0KSB8fCBpc05hTihsbC5sbmcpKSB7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0bXBMYXRMbmcucHVzaChsbCBhcyBMLkxhdExuZyk7XG4gICAgICAgIH0pO1xuXG4gICAgICAgIGNvbnN0IHBvbHlMaW5lOiBMLlBvbHlsaW5lID0gbmV3IEwuUG9seWxpbmUodG1wTGF0TG5nKTtcbiAgICAgICAgY29uc3QgYm91bmRzID0gcG9seUxpbmUuZ2V0Qm91bmRzKCk7XG5cbiAgICAgICAgcmV0dXJuIGJvdW5kcztcblxuICAgIH1cbn1cblxuLy9leHBvcnQgY2xhc3MgRnJlZWRyYXdTdWJ0cmFjdCBleHRlbmRzIEwuRnJlZURyYXcge1xuXG5cbi8vICAgIGNvbnN0cnVjdG9yKCkge1xuXG4vLyAgICAgICAgLy90aGlzIHdpbGwgYmVjb21lIEwuRnJlZURyYXdcbi8vICAgICAgICBzdXBlcihudWxsKTtcbi8vICAgICAgICAvL2NhbGwgbWV0aG9kcyBpbiBmcmVlZHJhdyBieSB0aGlzXG4vLyAgICAgICAgY29uc3QgZm9vID0gdGhpcy5zaXplKCk7XG5cbi8vICAgICAgICB0aGlzLmNvbnNvbGVMb2dOdW1iZXJPZlBvbHlnb25zKGZvbyk7XG5cbi8vICAgIH1cblxuLy8gICAgY29uc29sZUxvZ051bWJlck9mUG9seWdvbnMoc2l6ZTogbnVtYmVyKTogdm9pZCB7XG4vLyAgICAgICAgY29uc29sZS5sb2coXCJOdW1iZXIgb2YgcG9seWdvbnM6IFwiLCBzaXplKTtcbi8vICAgIH1cblxuLy99Il19